{% extends "layout/base.html" %}

{% block title %}Lá»‹ch sá»­ táº£i xuá»‘ng{% endblock %}

{% block content %}

<h2>ğŸ“œ Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng</h2>
<form method="get" class="history-filter">
    <div class="filter-group">
        <label>Tá»« ngÃ y</label>
        <input type="date"  name="from_date" value="{{ from_date }}">
    </div>

    <div class="filter-group">
        <label>Äáº¿n ngÃ y</label>
        <input type="date" name="to_date" value="{{ to_date }}">
    </div>

    <div class="filter-group search-group">
        <label>TÃªn Report</label>
        <input type="text"
               name="keyword"
               placeholder="TÃ¬m theo tÃªn report..."
               value="{{ keyword }}">
    </div>

    <button type="submit" class="btn filter-btn">ğŸ” Lá»c</button>

    {% if from_date or to_date %}
        <a href="{{ url_for('user.history') }}" class="btn reset-btn">âœ– Reset</a>
    {% endif %}
</form>
{% if histories_by_date %}
    {% for date, items in histories_by_date.items() %}
        <h3 class="history-date">ğŸ“… {{ date }}</h3>

        <table class="history-table">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>TÃªn report</th>
                    <th>HÃ nh Ä‘á»™ng</th>
                    <th>Thá»i gian</th>
                    <th>Thao tÃ¡c</th>
                </tr>
            </thead>
            <tbody>
                {% for h in items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td class="report-name">
                        <a href="{{ url_for('user.view_report', report_id=h.ReportId) }}"
                           title="{{ h.ReportName }}"
                           target="_blank">
                            {{ h.ReportName }}
                        </a>
                    </td>
                    <td>
                        {% if h.Action == 'download' %}
                            <span class="history-action download">â¬‡ Táº£i</span>
                        {% else %}
                            <span class="history-action view">ğŸ‘ Xem</span>
                        {% endif %}
                    </td>
                    <td>{{ h.CreatedAt.strftime('%H:%M') }}</td>
                    <td>
                        <a href="{{ url_for('user.view_report', report_id=h.ReportId) }}"
                           target="_blank" class="btn view">ğŸ‘ Xem</a>

                        <button
                            class="btn download"
                            data-report-id="{{ h.ReportId }}"
                        >
                            â¬‡ Táº£i
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}
{% else %}
<p>ChÆ°a cÃ³ lá»‹ch sá»­ hoáº¡t Ä‘á»™ng nÃ o.</p>
{% endif %}

{% endblock %}
